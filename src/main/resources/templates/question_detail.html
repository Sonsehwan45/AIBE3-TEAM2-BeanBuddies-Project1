<html layout:decorate="~{layout}">
<div layout:fragment="content" class="question-detail">

    <h1 th:text="${question.title}">제목</h1>
    <p th:text="${question.content}">내용</p>
    <p class="subtext" th:text="'작성자: ' + ${question.author.nickname}"></p>
    <p class="meta" th:text="'작성일: ' + ${#temporals.format(question.createdDate,'yyyy-MM-dd HH:mm')}"></p>
    <p class="meta" th:text="'수정일: ' + ${#temporals.format(question.modifiedDate,'yyyy-MM-dd HH:mm')}"></p>

    <div sec:authorize="isAuthenticated()">
        <a th:if="${#authentication.name == question.author.username}" th:href="@{/question/modify/{id}(id=${question.id})}" class="btn">수정</a>
        <form th:if="${#authentication.name == question.author.username}" th:action="@{/question/delete/{id}(id=${question.id})}" method="post" class="inline-form">
            <button type="submit" class="btn btn-danger" onclick="return confirm('정말 삭제하시겠습니까?');">삭제</button>
        </form>
    </div>

    <div class="answer-form">
        <h3>답변 작성</h3>
        <form sec:authorize="isAuthenticated()" th:action="@{/answer/write/{id}(id=${question.id})}" method="post" th:object="${form}">
            <textarea th:field="*{content}" rows="4" placeholder="답변 내용을 입력하세요"></textarea>
            <div th:if="${#fields.hasErrors('content')}" class="field-error">
                <p th:errors="*{content}"></p>
            </div>
            <button type="submit" class="btn">답변 등록</button>
        </form>

        <div sec:authorize="!isAuthenticated()">
            <textarea rows="4" placeholder="로그인 후 이용하실 수 있습니다." readonly></textarea>
        </div>
    </div>

    <div class="answer-list">
        <h3>답변 목록</h3>
        <ul>
            <li th:each="answer : ${question.answers}">
                <p th:text="${answer.content}"></p>
                <p class="subtext">작성자: <span th:text="${answer.author.nickname}"></span></p>
                <a th:if="${#authentication.name == answer.author.username}" th:href="@{/answer/modify/{question_id}/{answer_id}(question_id=${question.id}, answer_id=${answer.id})}" class="btn">수정</a>
                <form th:if="${#authentication.name == answer.author.username}" th:action="@{/answer/delete/{question_id}/{answer_id}(question_id=${question.id}, answer_id=${answer.id})}" method="post" class="inline-form">
                    <button type="submit" class="btn btn-danger" onclick="return confirm('정말 삭제하시겠습니까?');">삭제</button>
                </form>
            </li>
        </ul>
    </div>

</div>
</html>
